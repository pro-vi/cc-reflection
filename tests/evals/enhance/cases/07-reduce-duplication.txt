refactor lib/reflection-state.ts to reduce CLI handler duplication
